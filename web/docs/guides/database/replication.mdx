---
id: replication
title: "レプリケーション"
slug: replication
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


レプリケーションは、あるデータベースから別のデータベースへデータをコピーする技術です。これは次のような場合に有効です。

- 「負荷」を分散させる。例えば、データベースに多くの読み取りがある場合、2つのデータベースに分割できます。
- 待ち時間の短縮。例えば、ヨーロッパのお客様にはロンドンに、アメリカのお客様にはニューヨークにデータベースを設置したい場合があります。
- Supabaseの場合は、内蔵されているレプリケーション機能を利用して、リアルタイムのAPIを提供しています。



## パブリケーション

パブリケーションとは、どの変更を他のシステム（通常は他のPostgresデータベース）に送信するかを選択する方法です。


### 出版物の管理

Supabaseは出版物を管理するためのインターフェースを提供していますが、SQLを使用できます。

<!-- textlint-disable -->

<Tabs
defaultValue="UI"
values={[
  {label: 'UI', value: 'UI'},
  {label: 'SQL', value: 'SQL'},
]}>
<TabItem value="UI">

<!-- textlint-enable -->

```sh
1. Go to the "Database" section.
2. Click on "Replication" in the sidebar.
3. Control which database events are sent by toggling the Insert/Update/Delete toggles.
4. Control which tables broadcast changes by clicking into the "Source" and toggling the tables.
```

<video width="99%" muted playsInline controls="true">
<source src="/docs/videos/api/api-realtime.mp4" type="video/mp4" muted playsInline />
</video>

</TabItem>
<TabItem value="SQL">

```sql
alter publication supabase_realtime add table products;
```

</TabItem>
</Tabs>

### 出版物の作成

このパブリケーションは、すべてのテーブルに対するすべての変更を含みます。

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
create publication publication_name 
for all tables;
```


</TabItem>

</Tabs>

### 個々のテーブルをリッスンするパブリケーションの作成

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
create publication publication_name 
for table table_one, table_two;
```


</TabItem>

</Tabs>

### 既存のパブリケーションにテーブルを追加する

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
alter publication publication_name 
add table table_name;
```


</TabItem>

</Tabs>

### `インサート`を聞く

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
create publication publication_name 
for all tables
with (publish = 'insert');
```


</TabItem>

</Tabs>

### `更新`を聞く

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
create publication publication_name 
for all tables
with (publish = 'update');
```


</TabItem>

</Tabs>

### `削除`を聞く


<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
create publication publication_name 
for all tables
with (publish = 'delete');
```


</TabItem>

</Tabs>

### パブリケーションの削除

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
drop publication if exists publication_name;
```


</TabItem>

</Tabs>

### パブリケーションの再作成

パブリケーションの再作成を計画している場合は、操作が確実に成功するよう、トランザクション内で行うことが最善です。

<!-- textlint-disable -->

<Tabs
  defaultValue="sql"
  groupId="reference/postgres"
  values={[{ label: 'SQL', value: 'sql' }]}>

<TabItem value="sql">

<!-- textlint-enable -->

```sql
begin; 
  -- remove the realtime publication
  drop publication if exists publication_name; 

  -- re-create the publication but don't enable it for any tables
  create publication publication_name;  
commit;
```


</TabItem>

</Tabs>
