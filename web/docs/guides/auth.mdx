---
id: auth
title: 認証
description: Use Supabase to Authenticate and Authorize your users.
---

<!-- textlint-disable -->

import Link from '@docusaurus/Link'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import providers from '@site/src/data/authProviders'

<!-- textlint-enable -->

<iframe
  className="w-full video-with-border"
  width="640"
  height="385"
  src="https://www.youtube-nocookie.com/embed/6ow_jW4epf8"
  frameBorder="1"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
  allowFullScreen
></iframe>

## ユーザー管理

Supabaseでは、ユーザーの管理を簡単に行うことができます。

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/auth-zoom2.mp4" type="video/mp4" muted playsInline />
</video>

ユーザーがサインアップすると、SupabaseはユーザーにユニークなIDを割り当てます。このIDはデータベース内のどこでも参照できます。例えば、`user_id`フィールドを使って、`auth.users`テーブルの`id`を参照する`profiles`テーブルを作成できます。

Supabaseは、アプリやWebサイトのユーザーを[サインアップ](/docs/reference/javascript/auth-signup)、[ログイン](/docs/reference/javascript/auth-signin)、[ログアウト](/docs/reference/javascript/auth-signout)し、管理するための手段を提供します。

## サードパーティーのログイン

現在、以下のOAuthプロバイダをサポートしています。

<div class="container" style={{}}>
  <div class="row is-multiline">
    {providers.map((x) => (
      <div key={x.name} class="col col--3">
        <Link class="card" to={x.href}>
          <div class="card__body" style={{ display: 'flex', gap: 20 }}>
            {x.logo && <img src={x.logo} alt={x.name} width="20" />}
            <p>{x.name}</p>
          </div>
        </Link>
      </div>
    ))}
  </div>
</div>

「Authentication」→「Settings」→「External OAuth Providers」と進みます。それぞれに「Client ID」と「Secret」を入力することで、プロバイダーを有効にできます。

![OAuthログイン](/img/supabase-oauth-logins.png)

## 行レベルセキュリティー

認証はそこまでしかできません。緻密な認証ルールが必要な場合、PostgreSQLの[行レベルセキュリティー（Row Level Security - RLS）](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)に勝るものはありません。SupabaseではRLSのオン・オフを簡単に設定できます。

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/rls-zoom2.mp4" type="video/mp4" muted playsInline />
</video>

## ポリシー

[ポリシー](https://www.postgresql.org/docs/current/sql-createpolicy.html)はPostgreSQLのルールエンジンです。非常に強力で柔軟性があり、固有のビジネスニーズに合った複雑なSQLルールを書くことができます。

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/policies-zoom2.mp4" type="video/mp4" muted playsInline />
</video>

ポリシーを使えば、データベースがルールエンジンとなります。このように、クエリを繰り返しフィルタリングする必要はなくなります。

```js
const loggedInUserId = 'd0714948'
let { data, error } = await supabase
  .from('users')
  .select('user_id, name')
  .eq('user_id', loggedInUserId)

// console.log(data)
// => { id: 'd0714948', name: 'Jane' }
```

データベースのテーブルに`auth.uid() = user_id`というルールを定義するだけで、ミドルウェアからフィルターを削除しても、リクエストはルールを通過した行を返してくれます。

```js
let user = await supabase.from('users').select('user_id, name')

// console.log(data)
// Still => { id: 'd0714948', name: 'Jane' }
```


## 仕組み

1. ユーザーがサインアップします。Supabaseは、`auth.users`テーブルに新しいユーザーを作成します。
2. Supabaseは、ユーザーの`UUID`を含む新しいJWTを返します。
3. データベースへのすべてのリクエストに、JWTも一緒に送信します。
4. PostgresはJWTを検査して、リクエストを行ったユーザーを特定します。
5. ユーザーのUIDは、行へのアクセスを制限するポリシーで使用できます。

Supabaseは、JWTからユーザーのUIDを抽出するPostgresの特別な関数、`auth.uid()`を提供しています。これは特にポリシーを作成する際に便利です。

## Tips

#### プライベートなテーブルのリアルタイム機能を無効化

私たちのリアルタイム・サーバーは、ユーザーごとのセキュリティーを提供していません。WebSocket用のより強固な認証システムを構築するまでは、プライベートテーブルのリアルタイム機能を無効にできます。これを行うには、Postgresレプリケーションのパブリケーション管理で行います。

```sql
/**
 * リアルタイム・サブスクリプション
 * パブリックなテーブルでのみ、リアルタイムでのリスニングを許可する。
 */

begin;
  -- リアルタイム・パブリケーションを削除
  drop publication if exists supabase_realtime;

  -- パブリケーションを再作成しますが、どのテーブルに対しても有効にしません
  create publication supabase_realtime;
commit;

-- パブリケーションにテーブルを追加
alter publication supabase_realtime add table products;

-- 他のテーブルをパブリケーションに追加
alter publication supabase_realtime add table posts;
```

現在、[拡張したリアルタイムのセキュリティー](https://github.com/supabase/walrus)を開発しています。


## 次のステップ

- 認証については、[ガイド](/docs/guides/auth/intro)で詳しく解説
- サインイン：[app.supabase.io](https://app.supabase.io)
