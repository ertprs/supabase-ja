---
id: database
title: データベース
description: Supabaseでデータを管理します。
---

import ExtensionsComponent from '@site/src/components/Extensions'

Supabaseは、非常にスケーラブルなリレーショナル・データベースである[Postgres](/docs/postgres/server/about)の上に構築されています。

## 機能

### テーブル・ビュー 

Supabaseは、データベースの専門家でなくても使い始めることができます。Supabaseのテーブル・ビューは、Postgresを表計算ソフトのように簡単な操作で使えます。

![テーブル・ビュー](/img/table-view.png)


### 関連

データ同士の関連を掘り下げます。


<video width="99%" loop="" muted="" playsInline="" controls="true">
<source src="/docs/videos/relational-drilldown-zoom.mp4" type="video/mp4" />
</video>


### テーブルの複製

表計算ソフトのように、テーブルを複製できます。

<video width="99%" muted playsInline controls={true}>
<source src="/docs/videos/duplicate-tables.mp4" type="video/mp4" muted playsInline />
</video>


### SQLエディター

Supabaseには、SQLエディターが付属しています。お気に入りのクエリを保存して、後で実行できます。 

<video width="99%" muted playsInline controls={true}>
<source src="/docs/videos/favorites.mp4" type="video/mp4" muted playsInline />
</video>


### その他の機能

- Supabaseは、私たちの[Realtime](https://github.com/supabase/realtime)を使用して、Postgresにリアルタイム機能を拡張しています。
- すべてのプロジェクトは完全なPostgresデータベースであり、`postgres`レベルのアクセス権を持っています。
<!-- textlint-disable jtf-style/1.1.3.箇条書き -->
- 管理されたバックアップ：データベースのバックアップはすべてSupabaseが行います。[^backups]
<!-- textlint-enable jtf-style/1.1.3.箇条書き -->
- データのインポート：CSVやExcelのスプレッドシートから直接インポートできます。

[^backups]Storage APIを介して保存されたオブジェクトは、データーベースにはオブジェクトのメタデータしか保存されないため、バックアップには含まれません。古いバックアップを復元しても、それ以降に削除されたオブジェクトは復元されません。

### 拡張機能

Postgresデータベースの機能を拡張するために、拡張機能を使用できます。
Supabaseのダッシュボード内のボタンをクリックすることで、Postgresの拡張機能を有効にできます。

<video width="99%" muted playsInline controls={true}>
<source src="/docs/videos/toggle-extensions.mp4" type="video/mp4" muted playsInline />
</video>

Supabaseで提供されているすべての拡張機能については、[こちら](/docs/guides/database/extensions)を参照してください。

## Tips

### リアルタイム

SupabaseはPostgresの上にリアルタイムエンジンを提供しており、変更が発生したときにそれをリッスンできます。 
Supabaseのリアルタイム・エンジンは、Postgresに組み込まれたレプリケーション機能を利用しています。

Realtime Serverは、行単位セキュリティー（RLS）ポリシーに応じて、データベースの変更を許可されたユーザーにブロードキャストします。
パブリケーションに追加するテーブルでは、行単位セキュリティーを有効にして行セキュリティーポリシーを設定することをお勧めします。
ただし、テーブルでRLSを無効にして、接続しているすべてのクライアントに変更をブロードキャストもできます。

リアルタイム・システムを管理するには簡単です。`supabase_realtime`パブリケーションを[更新する]((/docs/guides/database/replication))だけです。

例えば、次のように個別のテーブルのみリアルタイム性を持たせることができます。

```sql
begin; 
  -- リアルタイム・パブリケーションを削除
  drop publication if exists supabase_realtime; 

  -- パブリケーションを再作成しますが、どのテーブルに対しても有効にしません
  create publication supabase_realtime;  
commit;

-- テーブルにパブリケーションを追加
alter publication supabase_realtime add table products;

-- 他のテーブルにパブリケーションを追加
alter publication supabase_realtime add table posts;
```

デフォルトでは「新しい」値のみが送信されます。レコードを`update`や`delete`したときに、古いレコード（以前の値）も受信できます。その場合は、テーブルのレプリカIDを更新して`full`に設定します。

```sql
alter table your_table replica identity full;
```

### プロジェクト間の移行

<<<<<<< HEAD
既存のSupabaseプロジェクトがあって、それを新しい（出来たての）プロジェクトに移行したい場合は、以下の手順を踏むだけでOKです。
=======
Migrating projects can be achieved using standard PostgreSQL tooling. This is particularly useful for older projects (e.g. to use a newer Postgres version). 
>>>>>>> 8cab88282ddc8ae26092bec8852273e68fcc8760

#### はじめる前に

<<<<<<< HEAD
- [リアルタイムを無効化](/docs/guides/api#managing-realtime)しているか確認してください。これにより、新しいデータベースへの挿入のパフォーマンスが向上します。
- [`psql`](https://www.postgresql.org/docs/13/app-psql.html)がコンピューターにインストールされていることを確認して、`pg_dump`を実行します。
=======
- Make sure [Postgres](https://www.postgresql.org/download/) is installed so you can run `psql` and `pg_dump`.
- Create a new Supabase project.
- If you enabled Function Hooks on your old project, enable it on your new project.
- Store the old project's database URL as `$OLD_DB_URL` and the new project's as `$NEW_DB_URL`.
>>>>>>> 8cab88282ddc8ae26092bec8852273e68fcc8760

#### データベースの移行

<<<<<<< HEAD
まず、データベースの構造だけを取得します。

```sh
pg_dump \
-h db.PROJECT_REF.supabase.co \
-U postgres \
--clean \
--schema-only \
> supabase_schema.sql
```

このコマンドを実行すると、コンピューター上に`supabase_schema.sql`というファイルが作成されます。 

新しいSupabaseプロジェクトを作成したら、それを使ってデータベース構造を復元します。

```sh
psql \
-h db.NEW_PROJECT_REF.supabase.co \
-U postgres \
< supabase_schema.sql
```

エラーを表示する場合があります。リストアでは、テーブルが存在する場合はドロップを試み、存在しない場合はエラーが表示されます。これらのエラーは情報提供のみで、心配する必要はありません。


#### データを移行（オプション）

データベース内のすべてのデータを移行できますが、`storage`スキーマ内のデータはデータベースの外に存在するため、移行しないようにします。 
今のところは、`public`と`auth`スキーマ内のすべてのデータを取得します。

```sh
pg_dump \
-h db.PROJECT_REF.supabase.co \
-U postgres \
--data-only \
-n public \
-n auth \
> supabase_data.sql
```

このコマンドを実行すると、コンピューター上に`supabase_data.sql`というファイルが作成されます。このファイルを使って、新しいデータベースのデータを復元できます。

```sh
psql \
-h db.NEW_PROJECT_REF.supabase.co \
-U postgres \
< supabase_data.sql
```
=======
1. Run `ALTER ROLE postgres SUPERUSER` in the *old* project's SQL editor
2. Run `pg_dump --clean --if-exists --quote-all-identifiers -d $OLD_DB_URL > dump.sql` from your terminal
3. Run `ALTER ROLE postgres NOSUPERUSER` in the *old* project's SQL editor
4. Run `ALTER ROLE postgres SUPERUSER` in the *new* project's SQL editor
5. Run `psql $NEW_DB_URL -f dump.sql` from your terminal
6. Run `TRUNCATE storage.objects` in the *new* project's SQL editor
7. Run `ALTER ROLE postgres NOSUPERUSER` in the *new* project's SQL editor

#### Caveats
>>>>>>> 8cab88282ddc8ae26092bec8852273e68fcc8760

- The new project will have the old project's Storage buckets, but not the objects. You will need to migrate Storage objects manually.

### プロジェクトのパスワードをリセット

Supabaseで新規プロジェクトを作成する際に、パスワードの入力を求められます。このパスワードを使って、Postgresデータベースに直接接続できます。

パスワードを忘れてしまった場合は、ダッシュボードのSQLエディターからパスワードを再設定できます。

以下のように実行します。

```sql
alter user postgres 
with password 'new_password';
```

詳しくは[データベースの設定](/docs/guides/database/managing-passwords)をご覧ください。

### サーバーのタイムゾーンを変更

データベースはUTCタイムゾーンで初期化されます。時刻の計算に便利なので、このままにしておくことをお勧めします。しかし、タイムゾーンを更新したい場合は、[データベースのタイムゾーン](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)のいずれかを使って更新できます。

以下のように実行します。

```sql
alter database postgres set timezone to 'America/New_York';
```

詳しくは[データベースの設定](/docs/guides/database/managing-passwords)をご覧ください。

## 次のステップ

- [Postgres](/docs/postgres/server/about)についてもっと理解する
- サインイン：[app.supabase.io](https://app.supabase.io)
